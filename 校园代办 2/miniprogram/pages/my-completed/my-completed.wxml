<!-- pages/my-completed/my-completed.wxml -->
<view class="container">
  <!-- æˆå°±å¡ç‰‡ -->
  <view class="achievement-card">
    <view class="achievement-badge">ğŸ†</view>
    <view class="achievement-title">å·²å®Œæˆçš„ä»»åŠ¡</view>
    <view class="achievement-desc">ç»§ç»­åŠªåŠ›ï¼Œå®Œæˆæ›´å¤šä»»åŠ¡ï¼</view>
    <view class="achievement-stats">
      <view class="stat-item">
        <text class="stat-value">{{taskStats.total || 0}}</text>
        <text class="stat-label">æ€»å®Œæˆ</text>
      </view>
      <view class="stat-item">
        <text class="stat-value">Â¥{{totalEarnings || 0}}</text>
        <text class="stat-label">æ€»æ”¶å…¥</text>
      </view>
    </view>
  </view>

  <!-- ç±»å‹ç­›é€‰ -->
  <view class="filter-tabs">
    <view class="filter-tab {{currentType === 'all' ? 'active' : ''}}" bindtap="changeType" data-type="all">
      å…¨éƒ¨
    </view>
    <view class="filter-tab {{currentType === 'published' ? 'active' : ''}}" bindtap="changeType" data-type="published">
      æˆ‘å‘å¸ƒçš„
    </view>
    <view class="filter-tab {{currentType === 'accepted' ? 'active' : ''}}" bindtap="changeType" data-type="accepted">
      æˆ‘æ¥å•çš„
    </view>
  </view>

  <!-- ä»»åŠ¡åˆ—è¡¨ -->
  <scroll-view class="task-list" scroll-y>
    <!-- ä»»åŠ¡é¡¹ -->
    <view class="task-item" wx:for="{{taskList}}" wx:key="id" bindtap="viewTaskDetail" data-id="{{item.id}}">
      <view class="task-header">
        <view class="task-type {{item.type}}">
          <text>{{item.type === 'express' ? 'å¿«é€’' : item.type === 'buy' ? 'ä»£ä¹°' : 'ä»£åŠ'}}</text>
        </view>
        <view class="task-role">
          <text>{{item.role === 'publisher' ? 'å‘å¸ƒ' : 'æ¥å•'}}</text>
        </view>
        <text class="task-reward">Â¥{{item.reward}}</text>
      </view>
      
      <view class="task-content">
        <text class="task-title">{{item.title}}</text>
        <view class="task-info">
          <text class="info-item">ğŸ“… {{item.createTime}}</text>
          <text class="info-item">âœ… {{item.completeTime}}</text>
        </view>
        
        <view class="task-partner">
          <text wx:if="{{item.role === 'publisher'}}">æ¥å•äºº: {{item.acceptor.name}}</text>
          <text wx:if="{{item.role === 'acceptor'}}">å‘å¸ƒäºº: {{item.publisher.name}}</text>
        </view>
        
        <view wx:if="{{item.rating}}" class="task-rating">
          <text>è¯„åˆ†: </text>
          <text class="stars">â­ Ã— {{item.rating}}</text>
        </view>
        
        <view wx:if="{{item.comment}}" class="task-comment">
          <text>è¯„ä»·: {{item.comment}}</text>
        </view>
      </view>
      
      <view class="task-footer">
        <view class="task-actions">
          <button 
            class="action-btn view" 
            bindtap="viewTaskDetail" 
            data-id="{{item.id}}"
          >
            æŸ¥çœ‹è¯¦æƒ…
          </button>
          <button 
            wx:if="{{!item.rating && item.role === 'publisher'}}" 
            class="action-btn rate" 
            bindtap="rateTask" 
            data-id="{{item.id}}"
          >
            è¯„ä»·æ¥å•äºº
          </button>
          <button 
            wx:if="{{!item.rating && item.role === 'acceptor'}}" 
            class="action-btn rate" 
            bindtap="rateTask" 
            data-id="{{item.id}}"
          >
            è¯„ä»·å‘å¸ƒäºº
          </button>
          <button 
            wx:if="{{item.rating}}" 
            class="action-btn rated" 
            disabled
          >
            å·²è¯„ä»·
          </button>
        </view>
      </view>
    </view>

    <!-- ç©ºçŠ¶æ€ -->
    <view wx:if="{{taskList.length === 0}}" class="empty-state">
      <view class="empty-icon">ğŸ‰</view>
      <text class="empty-title">æš‚æ— å·²å®Œæˆçš„ä»»åŠ¡</text>
      <text class="empty-desc">å¿«å»å‘å¸ƒæˆ–æ¥å–ä»»åŠ¡å§ï¼</text>
      <view class="empty-buttons">
        <button class="empty-btn" bindtap="goToPublish">å‘å¸ƒä»»åŠ¡</button>
        <button class="empty-btn secondary" bindtap="goToIndex">æ¥å–ä»»åŠ¡</button>
      </view>
    </view>
  </scroll-view>
</view>